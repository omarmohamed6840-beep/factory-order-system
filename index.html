<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>MT FACTORY</title>

<style>
body{
  margin:0;
  font-family:Tahoma, Arial;
  background:#f4f6f9;
}
header{
  background:#0b3c88;
  color:#fff;
  padding:15px;
  text-align:center;
  font-size:22px;
}
.container{
  max-width:1100px;
  margin:auto;
  padding:20px;
}
.card{
  background:#fff;
  border-radius:10px;
  padding:20px;
  margin-bottom:20px;
  box-shadow:0 4px 10px rgba(0,0,0,.08);
}
h3{
  margin-top:0;
  color:#0b3c88;
}
input, textarea{
  width:100%;
  padding:10px;
  margin:6px 0;
  border:1px solid #ccc;
  border-radius:6px;
  font-size:14px;
}
button{
  padding:10px 14px;
  border:none;
  border-radius:6px;
  cursor:pointer;
  font-size:14px;
}
.btn-main{background:#0b3c88;color:#fff}
.btn-del{background:#c0392b;color:#fff}
.btn-edit{background:#7f8c8d;color:#fff}
.hidden{display:none}
.order{
  border:1px solid #ddd;
  border-radius:8px;
  padding:10px;
  margin-bottom:8px;
}
.order-header{
  display:flex;
  justify-content:space-between;
  cursor:pointer;
  font-weight:bold;
}
.details{
  background:#eef3ff;
  margin-top:10px;
  padding:10px;
  border-radius:6px;
}
.totalBox{
  background:#0b3c88;
  color:#fff;
  padding:20px;
  border-radius:10px;
}
.totalBox p{margin:6px 0}
.loginBox{
  max-width:400px;
  margin:120px auto;
}
</style>
</head>

<body>

<header>MT FACTORY</header>

<!-- LOGIN -->
<div class="card loginBox" id="loginBox">
  <h3>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h3>
  <input type="password" id="password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
  <button class="btn-main" onclick="login()">Ø¯Ø®ÙˆÙ„</button>
</div>

<!-- APP -->
<div class="container hidden" id="app">

<div class="card">
  <h3>Ø¥Ø¶Ø§ÙØ© / ØªØ¹Ø¯ÙŠÙ„ Ø£ÙˆØ±Ø¯Ø±</h3>
  <input id="customer" placeholder="Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„">
  <input id="phone" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„">
  <input id="address" placeholder="Ø§Ù„Ø¹Ù†ÙˆØ§Ù†">
  <input id="product" placeholder="Ø§Ù„Ù…Ù†ØªØ¬">
  <input id="price" type="number" placeholder="Ø§Ù„Ø³Ø¹Ø±">
  <button class="btn-main" onclick="saveOrder()">Ø­ÙØ¸ Ø§Ù„Ø£ÙˆØ±Ø¯Ø±</button>
</div>

<div class="card">
  <h3>Ø¨Ø­Ø« Ø¨Ø±Ù‚Ù… Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„</h3>
  <input id="search" placeholder="Ø§ÙƒØªØ¨ Ø±Ù‚Ù… Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„" oninput="renderOrders()">
</div>

<div class="card">
  <h3>Ø§Ù„Ø£ÙˆØ±Ø¯Ø±Ø§Øª</h3>
  <div id="orders"></div>
</div>

<div class="card">
  <h3>Cash Out (Ù…ØµØ±ÙˆÙØ§Øª)</h3>
  <input id="expenseNote" placeholder="Ø§ØªØµØ±ÙØª ÙÙŠ Ø¥ÙŠÙ‡ØŸ">
  <input id="expenseAmount" type="number" placeholder="Ø§Ù„Ù…Ø¨Ù„Øº">
  <button class="btn-edit" onclick="addExpense()">Ø¥Ø¶Ø§ÙØ© Ù…ØµØ±ÙˆÙ</button>
  <div id="expenses"></div>
</div>

<div class="totalBox">
  <p>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£ÙˆØ±Ø¯Ø±Ø§Øª: <b><span id="totalSales">0</span></b></p>
  <p>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª: <b><span id="totalExpenses">0</span></b></p>
  <p>Ø§Ù„ØµØ§ÙÙŠ: <b><span id="netTotal">0</span></b></p>
</div>

</div>

<script>
const PASSWORD = "factory123";

let orders = JSON.parse(localStorage.getItem("orders") || "[]");
let expenses = JSON.parse(localStorage.getItem("expenses") || "[]");
let editIndex = null;

const ordersDiv = document.getElementById("orders");
const expensesDiv = document.getElementById("expenses");

function login(){
  if(password.value === PASSWORD){
    loginBox.classList.add("hidden");
    app.classList.remove("hidden");
    renderOrders();
    renderExpenses();
  } else {
    alert("ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø®Ø·Ø£");
  }
}

function generateId(){
  return "ORD-" + String(orders.length + 1).padStart(4,"0");
}

function saveOrder(){
  if(!customer.value || !phone.value || !price.value){
    alert("Ø£ÙƒÙ…Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª");
    return;
  }

  if(editIndex === null){
    orders.push({
      id: generateId(),
      customer: customer.value,
      phone: phone.value,
      address: address.value,
      product: product.value,
      price: Number(price.value)
    });
  } else {
    orders[editIndex] = {
      ...orders[editIndex],
      customer: customer.value,
      phone: phone.value,
      address: address.value,
      product: product.value,
      price: Number(price.value)
    };
    editIndex = null;
  }

  localStorage.setItem("orders", JSON.stringify(orders));
  clearForm();
  renderOrders();
}

function clearForm(){
  customer.value="";
  phone.value="";
  address.value="";
  product.value="";
  price.value="";
}

function renderOrders(){
  ordersDiv.innerHTML="";
  let total = 0;
  const q = search.value.trim();

  orders
    .filter(o => o.phone.includes(q))
    .forEach((o,i)=>{
      total += o.price;
      ordersDiv.innerHTML += `
        <div class="order">
          <div class="order-header" onclick="toggleDetails(${i})">
            <span>${o.customer} - ${o.price}</span>
            <span>${o.id}</span>
          </div>
          <div class="details hidden" id="details-${i}">
            <p>ğŸ“ ${o.phone}</p>
            <p>ğŸ“ ${o.address}</p>
            <p>ğŸ“¦ ${o.product}</p>
            <button class="btn-edit" onclick="editOrder(${i});event.stopPropagation()">ØªØ¹Ø¯ÙŠÙ„</button>
            <button class="btn-del" onclick="deleteOrder(${i});event.stopPropagation()">Ø­Ø°Ù</button>
          </div>
        </div>
      `;
    });

  totalSales.innerText = total;
  calcNet();
}

function toggleDetails(i){
  document.getElementById("details-"+i).classList.toggle("hidden");
}

function editOrder(i){
  const o = orders[i];
  customer.value=o.customer;
  phone.value=o.phone;
  address.value=o.address;
  product.value=o.product;
  price.value=o.price;
  editIndex=i;
}

function deleteOrder(i){
  if(confirm("Ø­Ø°Ù Ø§Ù„Ø£ÙˆØ±Ø¯Ø±ØŸ")){
    orders.splice(i,1);
    localStorage.setItem("orders", JSON.stringify(orders));
    renderOrders();
  }
}

function addExpense(){
  if(!expenseNote.value || !expenseAmount.value) return;
  expenses.push({
    note: expenseNote.value,
    amount: Number(expenseAmount.value)
  });
  localStorage.setItem("expenses", JSON.stringify(expenses));
  expenseNote.value="";
  expenseAmount.value="";
  renderExpenses();
}

function renderExpenses(){
  expensesDiv.innerHTML="";
  let total = 0;
  expenses.forEach((e,i)=>{
    total += e.amount;
    expensesDiv.innerHTML += `
      <div class="order">
        ${e.note} - ${e.amount}
        <button class="btn-del" onclick="deleteExpense(${i})">Ø­Ø°Ù</button>
      </div>
    `;
  });
  totalExpenses.innerText = total;
  calcNet();
}

function deleteExpense(i){
  expenses.splice(i,1);
  localStorage.setItem("expenses", JSON.stringify(expenses));
  renderExpenses();
}

function calcNet(){
  netTotal.innerText =
    Number(totalSales.innerText) - Number(totalExpenses.innerText);
}
</script>

</body>
</html>
