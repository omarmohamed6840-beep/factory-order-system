<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8" />
  <title>MT FACTORY â€“ Order System</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f5f7fa;
      padding: 20px;
      direction: rtl;
    }
    .box {
      background: #fff;
      padding: 20px;
      border-radius: 8px;
      margin-bottom: 20px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    input, select, button {
      width: 100%;
      padding: 10px;
      margin-bottom: 10px;
      font-size: 15px;
    }
    button {
      background: #0b3c88;
      color: #fff;
      border: none;
      cursor: pointer;
    }
    .order {
      border-bottom: 1px solid #ddd;
      padding: 10px 0;
    }
  </style>
</head>

<body>

  <h2>MT FACTORY â€“ Order System</h2>

  <div class="box">
    <h3>Ø¥Ø¶Ø§ÙØ© Ø£ÙˆØ±Ø¯Ø±</h3>

    <input id="customer" placeholder="Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„">
    <input id="phone" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„">
    <input id="total" placeholder="Ø³Ø¹Ø± Ø§Ù„Ø¨ÙŠØ¹">
    <input id="cost" placeholder="Ø§Ù„ØªÙƒÙ„ÙØ©">
    <input id="paid" placeholder="Ø§Ù„Ù…Ø¯ÙÙˆØ¹">

    <select id="status">
      <option value="Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°">Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°</option>
      <option value="ØªÙ… Ø§Ù„ØªØ³Ù„ÙŠÙ…">ØªÙ… Ø§Ù„ØªØ³Ù„ÙŠÙ…</option>
    </select>

    <button onclick="addOrder()">Ø¥Ø¶Ø§ÙØ©</button>
  </div>

  <div class="box">
    <h3>Ø§Ù„Ø£ÙˆØ±Ø¯Ø±Ø§Øª</h3>
    <div id="orders"></div>
    <h4>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­: <span id="profit">0</span> Ø¬Ù†ÙŠÙ‡</h4>
  </div>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

  <script>
    // Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyCvcrAV2T9ocmKJzwBgkDGK18wXxnd3XV0",
      authDomain: "mt-factory.firebaseapp.com",
      projectId: "mt-factory",
      storageBucket: "mt-factory.appspot.com",
      messagingSenderId: "462981501394",
      appId: "1:462981501394:web:d9f1736711d3990220380b"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    console.log("ğŸ”¥ Firebase Connected");

    // Ø¹Ù†Ø§ØµØ± Ø§Ù„ØµÙØ­Ø©
    const customer = document.getElementById("customer");
    const phone = document.getElementById("phone");
    const total = document.getElementById("total");
    const cost = document.getElementById("cost");
    const paid = document.getElementById("paid");
    const status = document.getElementById("status");
    const ordersDiv = document.getElementById("orders");
    const profitSpan = document.getElementById("profit");

    let orders = JSON.parse(localStorage.getItem("factory_orders") || "[]");

    function generateOrderId() {
      let last = localStorage.getItem("last_order_number") || 0;
      last = Number(last) + 1;
      localStorage.setItem("last_order_number", last);
      return "ORD-" + String(last).padStart(4, "0");
    }

    function addOrder() {
      const order = {
        id: generateOrderId(),
        customer: customer.value,
        phone: phone.value,
        total: Number(total.value),
        cost: Number(cost.value),
        paid: Number(paid.value || 0),
        status: status.value,
        date: new Date().toISOString()
      };

      orders.push(order);
      localStorage.setItem("factory_orders", JSON.stringify(orders));
      db.collection("orders").doc(order.id).set(order);

      customer.value = phone.value = total.value = cost.value = paid.value = "";
      render();
    }

    function render() {
      ordersDiv.innerHTML = "";
      let profit = 0;

      orders.forEach(o => {
        const p = o.total - o.cost;
        profit += p;

        ordersDiv.innerHTML += `
          <div class="order">
            <b>${o.id}</b> â€“ ${o.customer} <br>
            Ø¨ÙŠØ¹: ${o.total} | ØªÙƒÙ„ÙØ©: ${o.cost} | Ø±Ø¨Ø­: ${p}
          </div>
        `;
      });

      profitSpan.innerText = profit;
    }

    render();
  </script>

</body>
</html>
