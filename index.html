<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>MT FACTORY - نظام الأوردرات</title>
<style>
body{font-family:Arial;background:#f4f6f9;margin:0}
header{background:#0b3c88;color:#fff;padding:15px;text-align:center}
.box{background:#fff;margin:20px;padding:20px;border-radius:8px}
input,button{padding:8px;margin:5px;width:100%}
button{background:#0b3c88;color:#fff;border:none;cursor:pointer}
.order{border-bottom:1px solid #ddd;padding:10px}
.hidden{display:none}
.totalBox{background:#eef3ff;padding:15px;border-radius:6px;margin-top:15px}
</style>
</head>

<body>

<header>
<h2>MT FACTORY</h2>
</header>

<!-- LOGIN -->
<div class="box" id="loginBox">
<h3>تسجيل الدخول</h3>
<input type="password" id="password" placeholder="كلمة المرور">
<button onclick="login()">دخول</button>
</div>

<!-- APP -->
<div class="box hidden" id="app">

<h3>إضافة أوردر</h3>
<input id="customer" placeholder="اسم العميل">
<input id="phone" placeholder="رقم الموبايل">
<input id="address" placeholder="العنوان">
<input id="product" placeholder="المنتج">
<input id="price" type="number" placeholder="السعر">

<button onclick="addOrder()">حفظ الأوردر</button>

<hr>

<h3>بحث برقم الأوردر</h3>
<input id="search" placeholder="ORD-0001" oninput="renderOrders()">

<hr>

<h3>الأوردرات</h3>
<div id="orders"></div>

<hr>

<h3>Cash Out (مصروفات)</h3>
<input id="expenseNote" placeholder="اتصرفت في إيه؟">
<input id="expenseAmount" type="number" placeholder="المبلغ">
<button onclick="addExpense()">إضافة مصروف</button>

<div id="expenses"></div>

<hr>

<h3>الإجماليات</h3>
<div class="totalBox">
<p>إجمالي الأوردرات: <b><span id="totalSales">0</span></b></p>
<p>إجمالي المصروفات: <b><span id="totalExpenses">0</span></b></p>
<p>الصافي بعد الخصم: <b><span id="netTotal">0</span></b></p>
</div>

</div>

<script>
const PASSWORD="factory123";
const ordersDiv=document.getElementById("orders");
const expensesDiv=document.getElementById("expenses");

let orders=JSON.parse(localStorage.getItem("orders")||"[]");
let expenses=JSON.parse(localStorage.getItem("expenses")||"[]");

function login(){
  if(password.value===PASSWORD){
    loginBox.classList.add("hidden");
    app.classList.remove("hidden");
    renderOrders();
    renderExpenses();
  } else alert("كلمة المرور خطأ");
}

function generateId(){
  return "ORD-"+String(orders.length+1).padStart(4,"0");
}

function addOrder(){
  if(!customer.value||!price.value) return alert("أكمل البيانات");

  const order={
    id:generateId(),
    customer:customer.value,
    phone:phone.value,
    address:address.value,
    product:product.value,
    price:Number(price.value)
  };

  orders.push(order);
  localStorage.setItem("orders",JSON.stringify(orders));
  clearOrderForm();
  renderOrders();
}

function clearOrderForm(){
  customer.value="";
  phone.value="";
  address.value="";
  product.value="";
  price.value="";
}

function addExpense(){
  if(!expenseNote.value||!expenseAmount.value)
    return alert("اكتب المصروف");

  const exp={
    note:expenseNote.value,
    amount:Number(expenseAmount.value)
  };

  expenses.push(exp);
  localStorage.setItem("expenses",JSON.stringify(expenses));
  expenseNote.value="";
  expenseAmount.value="";
  renderExpenses();
}

function renderOrders(){
  ordersDiv.innerHTML="";
  let sales=0;
  const q=search.value.toLowerCase();

  orders.filter(o=>o.id.toLowerCase().includes(q)).forEach(o=>{
    sales+=o.price;
    ordersDiv.innerHTML+=`
    <div class="order">
      <b>${o.id}</b> - ${o.customer}<br>
      ${o.product} | السعر: ${o.price}
    </div>`;
  });

  totalSales.innerText=sales;
  calculateNet();
}

function renderExpenses(){
  expensesDiv.innerHTML="";
  let expTotal=0;

  expenses.forEach(e=>{
    expTotal+=e.amount;
    expensesDiv.innerHTML+=`
      <div class="order">
        ${e.note} - ${e.amount}
      </div>`;
  });

  totalExpenses.innerText=expTotal;
  calculateNet();
}

function calculateNet(){
  const sales=Number(totalSales.innerText);
  const exp=Number(totalExpenses.innerText);
  netTotal.innerText = sales - exp;
}
</script>

</body>
</html>
