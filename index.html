<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>MT FACTORY - نظام الأوردرات</title>
<style>
body{font-family:Arial;background:#f4f6f9;margin:0}
header{background:#0b3c88;color:#fff;padding:15px;text-align:center}
.box{background:#fff;margin:20px;padding:20px;border-radius:8px}
input,textarea,button{padding:8px;margin:5px;width:100%}
button{background:#0b3c88;color:#fff;border:none;cursor:pointer}
.order{border-bottom:1px solid #ddd;padding:10px;cursor:pointer}
.hidden{display:none}
.totalBox{background:#eef3ff;padding:15px;border-radius:6px;margin-top:15px}
.actions button{width:auto;margin:5px}
.details{background:#f9fbff;padding:10px;margin-top:10px;border-radius:6px}
</style>
</head>

<body>

<header><h2>MT FACTORY</h2></header>

<div class="box" id="loginBox">
<h3>تسجيل الدخول</h3>
<input type="password" id="password" placeholder="كلمة المرور">
<button onclick="login()">دخول</button>
</div>

<div class="box hidden" id="app">

<h3>إضافة / تعديل أوردر</h3>
<input id="customer" placeholder="اسم العميل">
<input id="phone" placeholder="رقم الموبايل">
<input id="address" placeholder="العنوان">
<input id="product" placeholder="المنتج">
<input id="price" type="number" placeholder="السعر">
<button onclick="saveOrder()">حفظ الأوردر</button>

<hr>

<h3>بحث برقم الأوردر</h3>
<input id="search" placeholder="ORD-0001" oninput="renderOrders()">

<hr>

<h3>الأوردرات</h3>
<div id="orders"></div>

<hr>

<h3>Cash Out (مصروفات)</h3>
<input id="expenseNote" placeholder="اتصرفت في إيه؟">
<input id="expenseAmount" type="number" placeholder="المبلغ">
<button onclick="addExpense()">إضافة مصروف</button>
<div id="expenses"></div>

<hr>

<h3>الإجماليات</h3>
<div class="totalBox">
<p>إجمالي الأوردرات: <b><span id="totalSales">0</span></b></p>
<p>إجمالي المصروفات: <b><span id="totalExpenses">0</span></b></p>
<p>الصافي بعد الخصم: <b><span id="netTotal">0</span></b></p>
</div>

</div>

<script>
const PASSWORD="factory123";
let orders=JSON.parse(localStorage.getItem("orders")||"[]");
let expenses=JSON.parse(localStorage.getItem("expenses")||"[]");
let editOrderIndex=null;

const ordersDiv=document.getElementById("orders");
const expensesDiv=document.getElementById("expenses");

function login(){
  if(password.value===PASSWORD){
    loginBox.classList.add("hidden");
    app.classList.remove("hidden");
    renderOrders(); 
    renderExpenses();
  } else alert("كلمة المرور خطأ");
}

function generateId(){
  return "ORD-"+String(orders.length+1).padStart(4,"0");
}

function saveOrder(){
  if(!customer.value||!price.value) return alert("أكمل البيانات");

  if(editOrderIndex===null){
    orders.push({
      id:generateId(),
      customer:customer.value,
      phone:phone.value,
      address:address.value,
      product:product.value,
      price:Number(price.value)
    });
  } else {
    Object.assign(orders[editOrderIndex],{
      customer:customer.value,
      phone:phone.value,
      address:address.value,
      product:product.value,
      price:Number(price.value)
    });
    editOrderIndex=null;
  }

  localStorage.setItem("orders",JSON.stringify(orders));
  clearOrderForm();
  renderOrders();
}

function clearOrderForm(){
  customer.value=phone.value=address.value=product.value=price.value="";
}

function renderOrders(){
  ordersDiv.innerHTML="";
  let sales=0;
  const q=search.value.toLowerCase();

  orders.filter(o=>o.id.toLowerCase().includes(q)).forEach((o,i)=>{
    sales+=o.price;
    ordersDiv.innerHTML+=`
    <div class="order" onclick="toggleDetails(${i})">
      <b>${o.id}</b> - ${o.customer} | ${o.price}
      <div class="details hidden" id="details-${i}">
        <p>موبايل: ${o.phone}</p>
        <p>عنوان: ${o.address}</p>
        <p>منتج: ${o.product}</p>
        <div class="actions">
          <button onclick="editOrder(${i});event.stopPropagation()">تعديل</button>
          <button onclick="deleteOrder(${i});event.stopPropagation()">حذف</button>
        </div>
      </div>
    </div>`;
  });

  totalSales.innerText=sales;
  calculateNet();
}

function toggleDetails(i){
  document.getElementById("details-"+i).classList.toggle("hidden");
}

function editOrder(i){
  const o=orders[i];
  customer.value=o.customer;
  phone.value=o.phone;
  address.value=o.address;
  product.value=o.product;
  price.value=o.price;
  editOrderIndex=i;
}

function deleteOrder(i){
  if(confirm("حذف الأوردر؟")){
    orders.splice(i,1);
    localStorage.setItem("orders",JSON.stringify(orders));
    renderOrders();
  }
}

function addExpense(){
  if(!expenseNote.value||!expenseAmount.value) return;
  expenses.push({note:expenseNote.value,amount:Number(expenseAmount.value)});
  localStorage.setItem("expenses",JSON.stringify(expenses));
  expenseNote.value=expenseAmount.value="";
  renderExpenses();
}

function renderExpenses(){
  expensesDiv.innerHTML="";
  let expTotal=0;
  expenses.forEach((e,i)=>{
    expTotal+=e.amount;
    expensesDiv.innerHTML+=`
      <div class="order">
        ${e.note} - ${e.amount}
        <button onclick="editExpense(${i})">تعديل</button>
        <button onclick="deleteExpense(${i})">حذف</button>
      </div>`;
  });
  totalExpenses.innerText=expTotal;
  calculateNet();
}

function editExpense(i){
  expenseNote.value=expenses[i].note;
  expenseAmount.value=expenses[i].amount;
  expenses.splice(i,1);
}

function deleteExpense(i){
  expenses.splice(i,1);
  localStorage.setItem("expenses",JSON.stringify(expenses));
  renderExpenses();
}

function calculateNet(){
  netTotal.innerText=
    Number(totalSales.innerText)-Number(totalExpenses.innerText);
}
</script>

</body>
</html>
